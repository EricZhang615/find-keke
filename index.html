<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>寻找唐可可</title>
    <meta name="author" content="https://github.com/plazum/find-keke">
    <style>
      body {
        text-align: center;
        margin: 0;
      }
      div {
        display: grid;
      }
      table {
        border-collapse: collapse;
      }
      tr {
        display: flex;
      }
      td {
        display: contents;
      }
      input[type=checkbox] {
        scale: 120%;
      }
      button {
        font-size: large;
      }
    </style>
    <script>
      var time = 0, d, time_string, last_rows, last_cols, hinted = false;
      console.log('%c ', 'padding: 35px 35px; background:url(https://zrtech.org/find-keke/keke.jpg) no-repeat;');
      console.log('是真的');

      function show_bubu() {
        if (document.getElementById("result").style.display != "none")
          return;
        document.getElementById("bubu").style.display = "contents";
        document.getElementById("bubu_video").play();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      function start_timing() {
        d = new Date();
        time = d.getTime();
      }
      function finish() {
        d = new Date();
        if (document.getElementById("result").style.display != "none")
          return;
        if (!hinted) {
          time = d.getTime() - time;
          time = Math.floor(time / 10);
          time_string = time / 100;
          if (time % 100 == 0)
            time_string += ".00";
          else if (time % 10 == 0)
            time_string += "0";
        } else {
          time = 114514;
          time_string = "2333.33";
        }
        if (time <= 300) {
          document.getElementById("time1").innerHTML = "恭喜你在三秒内找到了唐可可！用时" + time_string + "秒。";
          document.getElementById("niubi").style.display = "block";
        } else {
          document.getElementById("time2").innerHTML = "恭喜你找到了唐可可！用时" + time_string + "秒。";
          document.getElementById("time2").style.display = "block";
        }
        document.getElementById("result").style.display = "contents";
        document.getElementById("good_video").play();
        document.getElementById("bubu").style.display = "none";
        document.getElementById("keke").style.filter = "drop-shadow(2px 4px 6px black)";
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function generate_map(rows, cols) {
        var i, j, x, y;
        var board = [];
        var content = "";
        var selected = [];

        for (i = 0; i < 2; i++) {
          if (document.getElementById(i).checked) {
            selected.push(Object.values(image)[i]);
          }
        }
        if (selected.length == 0)
          return;

        reset();
        last_rows = rows;
        last_cols = cols;
        x = Math.floor(Math.random() * rows);
        y = Math.floor(Math.random() * cols);
        for (i = 0; i < rows; i++) {
          board[i] = Array.from({length: cols}, v=> Math.floor(Math.random() * selected.length));
        }
        for (i = 0; i < rows; i++) {
          content += "<tr>";
          for (j = 0; j < cols; j++) {
            content += "<td>" + (i == x && j == y ?
              '<img id="keke" onclick="finish()" src="keke.jpg">'
              :
              '<img onclick="show_bubu()" src="' + selected[board[i][j]] + '">'
            ) + "</td>";
          }
          content += "</tr>";
        }
        document.getElementById("banner").style.width = Math.max(cols * 75, 750) + "px";
        document.getElementById("map").innerHTML = content;
        start_timing();
      }
      function reset() {
        document.getElementById("result").style.display = "none";
        document.getElementById("niubi").style.display = "none";
        document.getElementById("time2").style.display = "none";
        document.getElementById("bubu").style.display = "none";
        document.getElementById("good_video").pause();
        document.getElementById("bubu_video").pause();
      }
      function hint() {
        if (hinted) {
          document.getElementById("hint").innerText = "给过提示了哦";
        }
        document.getElementById("keke").style.filter = "drop-shadow(2px 4px 6px black)";
        hinted = true;
      }
    </script>
  </head>
  <body>
    <div>
      <div id="result" style="display: none;">
        <table id="niubi" style="display: none; margin: 1em auto 1em auto;">
          <tr>
            <td><h1 id="time1" style="line-height: 60px;"></h1></td>
            <td><img src="niubi.jpg" width="203" height="103"></td>
          </tr>
        </table>
        <h1 id="time2" style="display: none; line-height: 60px;"></h1>
        <button style="margin: 0 auto 0 auto; font-size: x-large;" onclick="generate_map(last_rows, last_cols)">
          再来一局
        </button>
        <a style="margin: 1em auto 1em auto;" href="https://github.com/plazum/find-keke" target="_blank">
          来GitHub上切克闹（指check it out）吧↗
        </a>
        <video id="good_video" style="margin: auto;" src="good.mp4" loop></video>
      </div>
      <div id="bubu" style="display: none;">
        <h1>不是这个哦，请再试一次。</h1>
        <button style="margin: auto auto 1em auto; font-size: x-large;" onclick="generate_map(last_rows, last_cols)">
          再来一局
        </button>
        <video id="bubu_video" style="margin: auto;" src="bubu.mp4" loop></video>
      </div>
      <span style="margin: 1em auto 1em auto; font-size: larger;">
        <div style="display: block;" id="filter"></div>
        <br>
        <button onclick="generate_map(14, 10)">经典模式14×10</button>
        <button onclick="generate_map(14, 14)">扩展模式14×14</button>
        <button onclick="generate_map(20, 14)">困难模式20×14</button>
        <input id="rows" style="width: 3em; font-size: large;" type="number" value="14" min="1">
        ×
        <input id="cols" style="width: 3em; font-size: large;" type="number" value="10" min="1">
        <button onclick="generate_map(document.getElementById('rows').value,
                                      document.getElementById('cols').value)">
          自定义模式
        </button>
        <button id="hint" onclick="hint()">给点提示</button>
      </span>
      <a href="debug" title="担心网络加载速度影响计时？点此前往测试加载速度" style="display: contents;" target="_blank">
        <div id="banner" style="margin: auto; background-image: url(banner-extension.jpg);">
          <img style="margin: auto;" src="banner.jpg">
        </div>
      </a>
      <table id="map" style="margin: auto;">
      </table>
      <script>
        // 在此处添加更多的选项
        var image = {
          "南小鸟": "kotori.jpg",
          "渡边曜": "you.jpg",
          };
        (function init(){
          document.getElementById("filter").innerHTML = Object.keys(image).map((val, idx) => {
            return '<label><input id="'+idx+'" type="checkbox" checked onchange="generate_map(last_rows, last_cols)">'+val+'</label>'
            }).join('');
        }())
        generate_map(14, 10);
      </script>
    </div>
  </body>
</html>
